#!/bin/bash
adv7611_io_map_addr=(0xF4 0xF5 0xF8 0xF9 0xFA 0xFB 0xFD 0x01 0x00 0x02 0x03 0x05 0x06 0x0B 0x0C 0x14 0x15 0x19 0x33 )
adv7611_io_map_data=(0x80 0x7C 0x4C 0x64 0x6C 0x68 0x44 0x06 0x19 0xf7 0x40 0x28 0xA6 0x44 0x42 0x3F 0x80 0x98 0x40 )

adv7611_hdmi_map_addr=(0x9B 0x00 0x03 0x6D 0x83 0x6F 0x85 0x87 0x8D 0x8E 0x1A 0x57 0x58 0x75 0x90 0x91 0x9D )
adv7611_hdmi_map_data=(0x03 0x00 0x10 0x00 0xFE 0x0C 0x1F 0x70 0x04 0x1E 0x8A 0xDA 0x01 0x10 0x04 0x1E 0x02 )

adv7511_init_addr=(0x41 0x98 0x9a 0x9c 0x9d 0xa2 0xa3 0xe0 0xf9 0x55 0x15 0x16 0xd0 0xaf 0x4c 0x40 0xd6 )
adv7511_init_data=(0x00 0x03 0xe0 0x30 0x61 0xa4 0xa4 0xd0 0x00 0x12 0x00 0x00 0x3c 0x04 0x04 0x00 0xC0 )

num_io_map=${#adv7611_io_map_addr[@]}
num_hdmi_map=${#adv7611_hdmi_map_addr[@]}
adv7511_init=${#adv7511_init_addr[@]}


sudo i2cset -f -y 1 0x4C 0xFF 0x00
sleep 1

for ((i=0; i<num_io_map; i++))
do
    sudo i2cset -f -y 1 0x4C ${adv7611_io_map_addr[i]} ${adv7611_io_map_data[i]}
    a=$(sudo i2cget -f -y 1 0x4C ${adv7611_io_map_addr[i]})
    echo "addr:"
    echo ${adv7611_io_map_addr[i]}
    echo "    ori_data:"
    echo ${adv7611_io_map_data[i]}
    echo "    data:"
    echo ${a}
    echo "\n"
done

for ((i=0; i<num_hdmi_map; i++))
do
    sudo i2cset -f -y 1 0x34 ${adv7611_hdmi_map_addr[i]} ${adv7611_hdmi_map_data[i]}
done

#Set HDMI FreeRun
sudo i2cset -f -y 1 0x22 0xBA 0x01

while true
do
    m=$(sudo i2cget -f -y 0 0x39 0x42)
    echo ${m}
    if ((m = 0xd0))
    then
        for ((i=0; i<adv7511_init; i++))
        do
            sudo i2cset -f -y 0 0x39 ${adv7511_init_addr[i]} ${adv7511_init_data[i]}
        done
        break 
    fi
    sleep 1
done